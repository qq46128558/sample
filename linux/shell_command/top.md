## top 性能分析工具
- 一个动态显示过程,即可以通过用户按键来不断刷新当前状态.
- 如果在前台执行该命令,它将独占前台,直到用户终止该程序为止.
- 比较准确的说,top命令提供了实时的对系统处理器的状态监视.
- 它将显示系统中CPU最“敏感”的任务列表.
- 该命令可以按CPU使用.内存使用和执行时间对任务进行排序；而且该命令的很多特性都可以通过交互式命令或者在个人定制文件中进行设定.

### 统计信息
~~~
l: load avg
top - 17:43:23 up 2 days,  4:00,  1 user,  load average: 0.08, 0.02, 0.01
~~~
- 当前时间
- 系统运行时间 时:分
- 当前登录用户数
- 系统负载, 即任务队列的平均长度. 分别是1min,5min,15min前到现在的平均值

~~~
t: task/cpu stats
Tasks: 107 total,   2 running, 105 sleeping,   0 stopped,   0 zombie
%Cpu(s):  0.3 us,  0.3 sy,  0.0 ni, 99.3 id,  0.0 wa,  0.0 hi,  0.0 si,  0.0 st
~~~
- 进程总数
- 正在运行的进程数
- 睡眠的进程数
- 停止的进程数
- 僵尸进程数

- us: 用户空间进程占用CPU百分比
    - us指标统计的是: 所有nice值小于等于0的用户空间进程的CPU使用率
    - 进程默认的nice值是0
- sy: 内核空间进程占用CPU百分比
- ni: 用户进程空间内改变过优先级的进程占用CPU百分比(高nice值的用户空间进程)
    - ni指标统计的是: 所有nice值大于0的用户空间进程的CPU使用率
    - 进程默认的nice值是0
    - nice值代表着一个进程使用CPU资源的优先程度
    - nice值越高,使用CPU的优先级就越低
    - 比如跑编译程序gcc(预计花几个小时),则可以增加gcc进程的nice值
- id: 空闲CPU百分比
- wa: 等待输入输出的CPU时间百分比(空闲等待io)
- hi: 中断上半部
- si: 中断下半部
- st: steal时间
- 主观分析
    - 理论上八个指标之和应是100%
    - id+wa之和越小,说明CPU越忙碌

~~~
m: memory info
KiB Mem :  2048124 total,   103864 free,   175684 used,  1768576 buff/cache
KiB Swap:        0 total,        0 free,        0 used.  1662972 avail Mem
~~~
- 单位K
- total: 物理内存总量
- free: 空闲内存总量
- used: 使用的物理内存总量
- buff/cache: 用作内核缓存的内存量

- 单位K
- total: 交换区总量
- free: 空闲交换区总量
- used: 使用的交换区总量
- avail Mem: 缓冲的交换区总量
    - 内存中的内容被换出到交换区，而后又被换入到内存，但使用过的交换区尚未被覆盖， 该数值即为这些内容已存在于内存中的交换区的大小。相应的内存再次被换出时可不必再对交换区写入

### 进程信息
~~~
  PID USER      PR  NI    VIRT    RES    SHR S %CPU %MEM     TIME+ COMMAND                            
 1022 root      20   0  138008   8496   2996 S  0.3  0.4   7:54.45 AliYunDun                          
26221 root      20   0  530524  46120  32112 S  0.3  2.3   7:36.81 dockerd                            
26226 root      20   0  227940  10472   7800 S  0.3  0.5   0:51.84 containerd                         
    1 root      20   0   37868   4644   2752 S  0.0  0.2   0:02.75 systemd                            
    2 root      20   0       0      0      0 S  0.0  0.0   0:00.00 kthreadd  
~~~
- PID: 进程id
    - PPID: 父进程ID
- USER: 进程所有者的用户名
    - RUSER: Real User Name
    - UID: 进程所有者的用户ID
    - GROUP: 进程所有者的组名
- PR: 优先级
- NI: nice值.负值表示高优先级,正值表示低优先级
- VIRT: 进程使用的虚拟内存总量,单位K
    - SWAP: 进程使用的虚拟内存中,被换出的大小
    - RES: 进程使用的、未被换出的物理内存大小
        - CODE: 可执行代码占用的物理内存大小
        - DATA: 可执行代码以外的部分(数据段+栈)占用的物理内存大小
        - RES=CODE+DATA
    - VIRT=SWAP+RES
- SHR: 共享内存大小
- S: 进程状态
    - D: 不可中断的睡眠状态
    - R: 运行
    - S: 睡眠
    - T: 跟踪/停止
    - Z: 僵尸进程
- STAT: 
- %CPU: 上次更新到现在的CPU时间占用百分比
- %MEM: 进程使用的物理内存百分比(RES)
- TIME+: 进程使用的CPU时间总计,单位1/100秒
    - 如: **7:36.81, 表示7分钟36秒又0.81秒**
    - TIME: 进程使用的CPU时间总计,单位秒
    - START: 
- COMMAND: 命令名/命令行
- TTY: 启动进程的终端名,不是从终端启动的进程则显示为?
    - 如: pts/0
- VSZ: 
- RSS:

    


### 快捷键(键盘操作)
- 常用
    - h: 帮助
    - q: 退出
    - P: 根据CPU使用百分比大小进行排序
    - M: 根据驻留内存大小进行排序
    - T: 根据时间/累计时间进行排序
    - W: 将当前设置写入~/.toprc文件中。这是写top配置文件的推荐方法
    - f/F: 选择显示的项
        - d: 选择项
        - s: 选择排序项
        - 右方向键: 选择排序栏目(然后上下移动)
        - 左方向键: 确认排序栏目
        - q: 退出
    - k: 终止一个进程
        - 输入pid
        - 输入信号15(终止)
        - 输入信号9(强制终止)
    - i: 忽略闲置和僵尸进程(S/Z),开关式命令
    - c: 切换显示command名/command行
    - s/d: 信息刷新时间间隔
    - </>: 左右切换排序的列
    - E: 切换summary的内存单位
    - e: 切换task的内存单位
    - R: 切换升序/降序
    - u/U: 过滤指定用户的tasks
- 不常用
    - l: 显示/隐藏 load avgs行
    - t: 显示/隐藏 task/cpu 行
    - m: 显示/隐藏 memory行
    - x: 高亮开关,显示当前排序的字段
    - y: 高亮开关,运行中的进程(默认高亮)
    - z: 颜色切换(上面的x/y)
    - b: 加粗/反色(x/y)
    - Z: 设置颜色方案
    - B: 切换粗体
    - r: renice,修改nice值
        - 退出top后将还原
    - S: 切换到累计时间
    - o/O: 改变显示项目的顺序(未理解)
    - C: 显示坐标(tasks/fields)
    - Y: 检查其他输出(未理解)
    - X: 调整列宽(未理解)
    - L: 定位字符串
        - &: 定位下一个
    - V: 树形显示进程及子进程
    - J: 数字左/右对齐
    - j: 字符串左/右对齐
    - H: tasks/threads切换(summary位置)
    - n/#: 任务显示行数


### 初始进入,我的常按
    x,b 反色显示当前排序字段
    E,e 切换内存显示为MB单位
    <,> 切换排序列

    W 保存当前top配置